﻿<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id='menteePage'>Mentee</title>
    
    <style>
        * {
            box-sizing: border-box;
            font-family: serif;
            color: white;
            
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .background-image {
            height: 100%;
            margin: 0;
            padding: 0;
            background-image: url(./CSS/Pictures/forest.jpg);
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .col-1     {width: 		  8.33%; }
	    .col-2     {width: 		 16.66%; }
	    .col-3     {width: 		 25.00%; }
	    .col-4     {width: 		 33.33%; }
	    .col-5     {width: 		 41.66%; }
	    .col-6     {width: 		 50.00%; }
	    .col-7     {width: 		 58.33%; }
	    .col-8     {width: 		 66.66%; }
	    .col-9     {width: 		 75.00%; }
	    .col-10    {width: 		 83.33%; }
	    .col-11    {width: 		 91.66%; }
	    .col-12    {width: 		100.00%; }

        [class*="col-"] {
            border: 1px ;
            float: left;
            
        }

		.row::after {
			content: 			"";
			clear: 				both;
			display: 			block;
		}

        #pictureFrame{
            padding: 2%;
            padding-top: 8%;
            padding-left: 8%;
            
        }
        #profilePicture {
            display: flex;
            max-width: 20vw;
            max-height: 24vh;
            vertical-align: middle;
            border-radius: 50%;
            background-color: grey;
           
        }

        .header {
            border-bottom: 5px solid black;
        }

        .header h1{
            font-size: 6vh;
            text-align: center;
        }

        #signOut{
            display: block;
            float: left;

        }

        h3{
            padding-left: 2em;
            display: block;
        }

        .menteeProgress{
            border-top: 5px solid black;
            padding-left: 1em;
            font-size: 4vh ;
            height: 36.5vh;
        }

        .recentActivity{
            border-left: 5px solid black;
            height: 38.3vh;
        }
            .recentActivity h2{
                text-align: center;
                font-size: 4vh;
            }
       

        input[type="file"] {
            
            display: none;
        }
        .fileUpload {
            margin-left: 20%;
            padding: 2%;
            display: inline-block;
            cursor: pointer;
            background: #000000;
            color: #ffffff;
            border: 0.5px solid darkorange;
            transition: ease-out .4s;
            
        }
        #leaveMentor {
            display: inline-block;
            cursor: pointer;
            background: #000000;
            color: #ffffff;
            border: 0.5px solid darkorange;
            transition: ease-out .4s;
            width: 145px;
            height: 50px;
            margin: 0;
            padding: 0;
            margin-top: 20px;
            font-size: 16pt;
        }
            .fileUpload:hover, #leaveMentor:hover {
                border: 0.5px solid darkorange;
                color: #000000;
                background: #ffffff;
            }
            .fileUpload:focus{
                outline: none;
            }

        .feedbackTable{
            border-radius: 15px 15px 15px 15px;
            background-color: grey;
            width: 80%;
            height: 50%;
            margin-left: 13%;
            border: 2px solid black;
            overflow:auto;
        }
        td{
            text-align: center;
            border: 2px solid black;
        }

        .darkbg {
            background: rgb(30, 30, 30, 0.65);
        }

        .lightbg {
            background: rgb(75, 75, 75, 0.65);
        }
        

        #tasks-header {
            font-size: 26pt;
        }
        
        #task-list {
            font-size: 20pt;
            padding-left: 20px;
        }

        #task-list label {
            margin-left: 10px;
        }

    </style>
</head>
<body onload="onload()">
    <div class="background-image">
        <div class="row darkbg">
            <div class="col-12 header">
                <h1>Mentor2Mentee</h1>

                <h3 id='welcome-user-heading'></h3>
                <h3 id="signOut"><a href="index.html">Sign Out</a></h3>

            </div>
        </div>
        <div class="row lightbg">
            <div class="col-3">
                <div id="pictureFrame"><img id="profilePicture" src="./CSS/Pictures/question_mark.png" /></div>
                <label class="fileUpload">
                    <input type="file" />Upload Photo
                </label>
            </div>
            <div class="col-9 recentActivity">

                <h2 id='tasks-header'>Tasks to Complete</h2>
                
                <div id="task-list" >
                    <div class="checkbox">
                        <input type="checkbox" value="1" id='tcheck1' onchange="checkOff(this.id, 1)"><label id='task1'></label>
                    </div>
                    <div class="checkbox">
                        <input type="checkbox" value="1" id='tcheck2' onchange="checkOff(this.id, 2)"><label id='task2'></label>
                    </div>
                    <div class="checkbox">
                        <input type="checkbox" value="1" id='tcheck3' onchange="checkOff(this.id, 3)"><label id='task3'></label>
                    </div>
                    <div class="checkbox">
                        <input type="checkbox" value="1" id='tcheck4' onchange="checkOff(this.id, 4)"><label id='task4'></label>
                    </div>
                    <div class="checkbox">
                        <input type="checkbox" value="1" id='tcheck5' onchange="checkOff(this.id, 5)"><label id='task5'></label>
                    </div>
                </div>

               
            </div>
        </div>
        <div class="row darkbg">
            <div class="col-12 menteeProgress">
                <button id="leaveMentor" onclick="leaveMentor()">Leave Mentor</button>
            </div>
            
        </div>

    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://mysqljs.com/mysql.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script>

gUser = localStorage.getItem('key');
console.log(String(gUser))

var tasknum1 = '';
var tasknum2 = '';
var tasknum3 = '';
var tasknum4 = '';
var tasknum5 = '';


window.addEventListener('load', function() {
    document.querySelector('input[type="file"]').addEventListener('change', function() {
        if (this.files && this.files[0]) {
            var img = document.querySelector('img'); 
            img.src = URL.createObjectURL(this.files[0]); // set src to blob url
            img.onload = imageIsLoaded;
        }
    });
});

function imageIsLoaded() { 
    alert("Profile Picture Changed");  // blob url
    document.getElementById("profilePicture").width = '250'
    document.getElementById("profilePicture").height = '250'
    // update width and height ...
}

function onload() {


    loadUser()
}

function loadUser() {
    var gUser = localStorage.getItem('key');
    var sqlStmt = 'SELECT * FROM Mentees ';
    var whereClause = "WHERE menteeEmail = '" + gUser + "';";
    var queryStmt = sqlStmt + whereClause;

    // Checkbox labels
    var totalTasks = [task1, task2, task3, task4, task5];

    tasknum1 = document.getElementById('task1');
    tasknum2 = document.getElementById('task2');
    tasknum3 = document.getElementById('task3');
    tasknum4 = document.getElementById('task4');
    tasknum5 = document.getElementById('task5');

    // Checkboxes for responsive coding
    var check1 = document.getElementById('tcheck1');
    var check2 = document.getElementById('tcheck2');
    var check3 = document.getElementById('tcheck3');
    var check4 = document.getElementById('tcheck4');
    var check5 = document.getElementById('tcheck5');
    var totalChecks = [check1, check2, check3, check4, check5];
    

    MySql.Execute(
        "107.180.1.16",
        "group7-2",
        "!!Group7",
        "group7-2",
        queryStmt,
        function(data) {
            console.log(data);

            document.getElementById('welcome-user-heading').innerHTML = 'Welcome ' + data['Result'][0].menteeName + '!';
            
            // Setting checkbox labels to specific task for skill
            var tnum1 = data['Result'][0].task1;
            var tnum2 = data['Result'][0].task2;
            var tnum3 = data['Result'][0].task3;
            var tnum4 = data['Result'][0].task4;
            var tnum5 = data['Result'][0].task5;

            var tnums = [tnum1, tnum2, tnum3, tnum4, tnum5];

            console.log(tnums);

            if (data['Result'][0].menteeSkill == 'Marketing') {
                console.log('Marketing Major');

                tasknum1.innerHTML = 'Use data to make decisions'
                tasknum2.innerHTML = 'Deliver specific, identifiable results'
                tasknum3.innerHTML = 'Create remarkable customer experiences'
                tasknum4.innerHTML = 'Know your customer and markets'
                tasknum5.innerHTML = 'Analyze a certain demographic and create a promotion for a popular product'

            }

            else if (data['Result'][0].menteeSkill == 'Economics') {
                console.log('Economics Major');

                tasknum1.innerHTML = 'Be able to interpret and forecast market trends'
                tasknum2.innerHTML = 'Research and analyze economic issues'
                tasknum3.innerHTML = 'Conduct surverys and collect data'
                tasknum4.innerHTML = 'Be able to advise businesses and individuals on economic topics'
                tasknum5.innerHTML = 'Make recommendations for solving economic problems'

            }

            else if (data['Result'][0].menteeSkill == 'Information Systems') {
                console.log('CIS Major');

                tasknum1.innerHTML = 'Be able to write multiple coding languages'
                tasknum2.innerHTML = 'Analyze needs and requirements when designing products'
                tasknum3.innerHTML = 'Judge the costs and benefits of a possible action'
                tasknum4.innerHTML = 'Choose a mathematical method or formula to solve problems'
                tasknum5.innerHTML = 'Understand new information or materials by studying and working with them'

            }

            else {
                console.log('No Skill??? Error somewhere in the DB....');
            }


            // Checks task boxes depending on if they were checked off previously
            for (i=0; i < tnums.length; i++) {
                    if (tnums[i] == 1) {
                        totalChecks[i].checked = true;
                    }
                    else if (tnums[i] == 0) {
                        totalChecks[i] = false;
                    }
                    
                }
        }
    )
}



function checkOff(tcheckID, tasknum) {

    var seeIfChecked = document.getElementById(tcheckID);
    console.log(seeIfChecked.checked);

    if (seeIfChecked.checked) {
        updtStmt = "UPDATE Mentees SET task" + tasknum + " = 1 WHERE menteeEmail = '" + gUser + "';";

        // Inserts into completed Task Log
        MySql.Execute(
        "107.180.1.16",
        "group7-2",
        "!!Group7",
        "group7-2",
        updtStmt,
        function (data) {
            console.log('Updated')

            var getUser = "SELECT * FROM Mentees "
            var join = "JOIN Mentors on Mentors.mentorID = Mentees.menteeID "
            var whereClaus = "WHERE menteeEmail = '" + gUser + "';";
            var finalStmt = getUser + join + whereClaus

            MySql.Execute(
                "107.180.1.16",
                "group7-2",
                "!!Group7",
                "group7-2",
                finalStmt,
                function (data) {
                    console.log(data);

                    var insertMenteeName = data['Result'][0].menteeName;
                    var insertMentorEmail = data['Result'][0].mentorEmail;
                    var insertTaskNum = 'task' + tasknum;
                    var insertTask = document.getElementById(insertTaskNum).innerHTML;

                    var insertStmt = 'INSERT INTO CompletedTasks (Date, Time, Name, MentorEmail, Description) Values ';
                    var insertValues = "(CURRENT_DATE(), CURRENT_TIME(), '" + insertMenteeName + "', '" + insertMentorEmail + "', 'Completed Task: " + insertTask + "');";
                    finalStmt = insertStmt + insertValues;
                    console.log(finalStmt);

                    MySql.Execute(
                        "107.180.1.16",
                        "group7-2",
                        "!!Group7",
                        "group7-2",
                        finalStmt,
                        function (data) {
                            console.log('Inserted');

                            // var insertMenteeName = data['Result'][0].menteeName;
                            // var insertMentorEmail = data['Result'][0].mentorEmail;

                            // var insertStmt = 'INSERT INTO CompletedTasks (Date, Time, Name, MentorEmail, Description) Values ';
                            // var insertValues = "(CURRENT_DATE(), CURRENT_TIME(), '" + insertMenteeName + "', '" + insertMentorEmail + "', 'Completed Task: " + tasknum + "');";
                            // finalStmt = insertStmt + insertValues;
                            // console.log(finalStmt);

                            // MySql.Execute(
                            //     "107.180.1.16",
                            //     "group7-2",
                            //     "!!Group7",
                            //     "group7-2",
                            //     finalStmt,
                            //     function (data) {
                            //         console.log('Deleted');
                            //     })
                        }
                    );
                }
            );
        }
    );

    }

    else if (!seeIfChecked.checked) {
        updtStmt = "UPDATE Mentees SET task" + tasknum + " = 0 WHERE menteeEmail = '" + gUser + "';";

        MySql.Execute(
        "107.180.1.16",
        "group7-2",
        "!!Group7",
        "group7-2",
        updtStmt,
        function (data) {
            console.log('Updated')

            var getUser = "SELECT * FROM Mentees "
            var join = "JOIN Mentors on Mentors.mentorID = Mentees.menteeID "
            var whereClaus = "WHERE menteeEmail = '" + gUser + "';";
            var finalStmt = getUser + join + whereClaus

            // Deletes record from task log when deselected
            MySql.Execute(
                "107.180.1.16",
                "group7-2",
                "!!Group7",
                "group7-2",
                finalStmt,
                function (data) {
                    console.log(data);

                    var insertMenteeName = data['Result'][0].menteeName;
                    var insertMentorEmail = data['Result'][0].mentorEmail;

                    var deleteStmt = 'DELETE FROM CompletedTasks WHERE ';
                    var deleteValues = "Name = '" + insertMenteeName + "' AND MentorEmail = '" + insertMentorEmail + "' AND DESCRIPTION LIKE ('%" + tasknum + "%');";
                    finalStmt = deleteStmt + deleteValues;
                    console.log(finalStmt);

                    MySql.Execute(
                        "107.180.1.16",
                        "group7-2",
                        "!!Group7",
                        "group7-2",
                        finalStmt,
                        function (data) {
                            console.log('Deleted');
                        });
                    
                }
            );
        }
    );

    }

    console.log(updtStmt);


    
}

function leaveMentor() {
    var choice = confirm("Please confirm you want to leave this mentor.");

    if (choice == true) {
        updtStmt = "UPDATE Mentees SET task1 = 0, task2 = 0, task3 = 0, task4 = 0, task5 = 0, mentorID = 0 WHERE menteeEmail = '" + gUser + "';";
        console.log(updtStmt);

        MySql.Execute(
            "107.180.1.16",
            "group7-2",
            "!!Group7",
            "group7-2",
            updtStmt,
            function (data) {
                console.log('Mentor removed');
                console.log(data['Error']);
                
            });
        window.location = "mentorSelect.html"
    }

    else {
        console.log('Canceled');
    }

}
</script>

</body>
</html>